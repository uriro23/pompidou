<div ng-controller="HeaderCtrl as headerModel">
<table ng-hide="orderModel.order.properties.template" style="width: 95%">
  <tbody>
    <tr ng-class="headerModel.order.view.changes.customer?'bg-success':null">
      <td style="width: 50%">
      <table>
        <tr>
      <td><label>
        <span ng-hide="headerModel.order.view.customer.isWholesaleCustomer">לקוח</span>
        <span ng-show="headerModel.order.view.customer.isWholesaleCustomer">סיטונאי</span>
      </label></td>
      <td>
        <button ng-click="headerModel.setCustomer(1,'בחירת לקוח')"
                ng-class="headerModel.order.view.errors.customer?'btn btn-danger':'btn btn-default'"
                class="btn btn-default"
                ng-disabled="headerModel.readOnly.is"
                ng-show="headerModel.order.view.customer.id">
          {{headerModel.order.view.customer.firstName + ' ' + headerModel.order.view.customer.lastName}}
        </button>
        <button ng-click="headerModel.setCustomer(1,'בחירת לקוח')"
                ng-class="headerModel.order.view.errors.customer?'btn bg-danger':'btn btn-default'"
                ng-disabled="headerModel.readOnly.is"
                ng-hide="headerModel.order.view.customer.id">
          בחר
        </button>
      </td>
      <td>
        <span ng-show="headerModel.order.view.customer.mobilePhone">טל' נייד: </span>
        <a href="tel:{{headerModel.order.view.customer.mobilePhone}}">{{headerModel.order.view.customer.mobilePhone}}</a>
      </td>
      <td>
        <span ng-show="headerModel.order.view.customer.homePhone">טל' בית: </span>
        <a href="tel:{{headerModel.order.view.customer.homePhone}}">{{headerModel.order.view.customer.homePhone}}</a>
      </td>
      <td>
        <span ng-show="headerModel.order.view.customer.workPhone">טל עבודה: </span>
        <a href="tel:{{headerModel.order.view.customer.workPhone}}">{{headerModel.order.view.customer.workPhone}}</a>
      </td>
      <td>
        <span ng-show="headerModel.order.view.customer.email">דואל: </span>
        <a href="mailto:{{headerModel.order.view.customer.email}}">{{headerModel.order.view.customer.email}}</a>
      </td>
    </tr>
        </table>
    </td>
      <td style="width: 50%" ng-hide="headerModel.order.properties.referralSource===5">
        <!-- hide if client referral, so we have space to show referring client selection -->
        <table>
          <tr>
            <td><label>איש קשר</label></td>
            <td>
              <button ng-click="headerModel.setCustomer(2,'בחירת איש קשר')"
                      ng-class="headerModel.order.view.errors.contact?'bg-danger':null"
                      class="btn btn-default"
                      ng-disabled="headerModel.readOnly.is"
                      ng-show="headerModel.order.view.contact.id">
                {{headerModel.order.view.contact.firstName + ' ' + headerModel.order.view.contact.lastName}}
              </button>
              <button ng-click="headerModel.setCustomer(2,'בחירת איש קשר')"
                      ng-class="headerModel.order.view.errors.contact?'bg-danger':null"
                      class="btn btn-default"
                      ng-disabled="headerModel.readOnly.is"
                      ng-hide="headerModel.order.view.contact.id">
                בחר
              </button>
            </td>
            <td>
              <span ng-show="headerModel.order.view.contact.mobilePhone">טל' נייד: </span>
              <a href="tel:{{headerModel.order.view.contact.mobilePhone}}">{{headerModel.order.view.contact.mobilePhone}}</a>
            </td>
            <td>
              <span ng-show="headerModel.order.view.contact.homePhone">טל' בית: </span>
              <a href="tel:{{headerModel.order.view.contact.homlePhone}}">{{headerModel.order.view.contact.homlePhone}}</a>
            </td>
            <td>
              <span ng-show="headerModel.order.view.contact.workPhone">טל עבודה: </span>
              <a href="tel:{{headerModel.order.view.contact.workPhone}}">{{headerModel.order.view.contact.workPhone}}</a>
            </td>
            <td>
              <span ng-show="headerModel.order.view.contact.email">דואל: </span>
              <a href="mailto:{{headerModel.order.view.contact.email}}">{{headerModel.order.view.contact.email}}</a>
            </td>
          </tr>
        </table>
      </td>
      <td style="width: 50%" ng-show="headerModel.order.properties.referralSource===5"><!--show only if client referral-->
        <table>
          <tr>
            <td><label>לקוח מפנה</label></td>
            <td>
              <button ng-click="headerModel.setCustomer(3,'בחירת לקוח מפנה')"
                      ng-class="headerModel.order.view.errors.referrer?'bg-danger':null"
                      class="btn btn-default"
                      ng-disabled="headerModel.readOnly.is"
                      ng-show="headerModel.order.view.referrer.id">
                {{headerModel.order.view.referrer.firstName + ' ' + headerModel.order.view.referrer.lastName}}
              </button>
              <button ng-click="headerModel.setCustomer(3,'בחירת לקוח מפנה')"
                      ng-class="headerModel.order.view.errors.referrer?'bg-danger':null"
                      class="btn btn-default"
                      ng-disabled="headerModel.readOnly.is"
                      ng-hide="headerModel.order.view.referrer.id">
                בחר
              </button>
            </td>
            <td>
              <span ng-show="headerModel.order.view.referrer.mobilePhone">טל' נייד: </span>
              <a href="tel:{{headerModel.order.view.referrer.mobilePhone}}">{{headerModel.order.view.referrer.mobilePhone}}</a>
            </td>
            <td>
              <span ng-show="headerModel.order.view.referrer.homePhone">טל' בית: </span>
              <a href="tel:{{headerModel.order.view.referrer.homlePhone}}">{{headerModel.order.view.referrer.homlePhone}}</a>
            </td>
            <td>
              <span ng-show="headerModel.order.view.referrer.workPhone">טל עבודה: </span>
              <a href="tel:{{headerModel.order.view.referrer.workPhone}}">{{headerModel.order.view.referrer.workPhone}}</a>
            </td>
            <td>
              <span ng-show="headerModel.order.view.referrer.email">דואל: </span>
              <a href="mailto:{{headerModel.order.view.referrer.email}}">{{headerModel.order.view.referrer.email}}</a>
            </td>
          </tr>
        </table>
      </td>
  </tbody>
  </table>
<table style="width: 99%">
  <tr ng-class="headerModel.order.view.changes.header?'bg-success':null">
    <td  ng-hide="orderModel.order.properties.template || orderModel.order.properties.isDateUnknown"
         style="width: 22%">
      <label>תאריך:</label>&nbsp;
      <input type='date' ng-model="headerModel.order.properties.eventDate"
                                 ng-change="headerModel.setEventDate()" required
                                 ng-class="headerModel.order.view.errors.eventDate?'bg-danger':null">
      <button class="btn btn-default btn-small"
              ng-click="headerModel.setDateUnknown()"
              ng-hide="orderModel.order.view.orderStatus.id > 1 && orderModel.order.view.orderStatus.id < 6">X</button>
      <span>בעבר?</span>
      <input type="checkbox" ng-model="headerModel.order.view.isAllowPastDate"
             ng-change="headerModel.checkEventDate()">
    </td>
    <td  ng-hide="orderModel.order.properties.template || orderModel.order.properties.isDateUnknown"
         style="width: 13%">
    <label>מסירה עד:</label>&nbsp
      <input type="time" ng-model="headerModel.order.properties.eventTime"
                               ng-disabled="headerModel.readOnly.is"
                               ng-change="headerModel.setEventTime()">
    </td>
    <td  ng-hide="orderModel.order.properties.template || !orderModel.order.properties.eventTime"
         style="width: 12%">
      <label>מ-</label>&nbsp
      <select ng-model="headerModel.order.view.eventTimeRange"
              ng-change="headerModel.setEventTime()"
              ng-options="eventTimeRange.label for eventTimeRange in headerModel.eventTimeRanges">
      </select>
    </td>
    <td  ng-hide="orderModel.order.properties.template || orderModel.order.properties.isDateUnknown"
         style="width: 12%">
      <label>יציאה:</label>&nbsp
      <input type="time" ng-model="headerModel.order.properties.exitTime"
                               ng-disabled="headerModel.readOnly.is"
                               ng-change="headerModel.setExitTime()"
                               ng-class="headerModel.order.view.errors.exitTime?'bg-danger':null">
    </td>
    <td style="width: 59%" ng-show="orderModel.order.properties.isDateUnknown">
      <label>תאריך לא ידוע:</label>
      <input type="checkbox" ng-model="headerModel.order.properties.isDateUnknown"
             ng-disabled="headerModel.readOnly.is"
             ng-change="headerModel.setKnownDate()">
    </td>
    <td style="width: 14%" ng-hide="headerModel.order.properties.isWholesaleEvent">
      <label>משתתפים:</label>&nbsp;<input type="number" min=1 max="9999"
                                          ng-model="headerModel.order.properties.noOfParticipants"
                                          ng-change="headerModel.setNoOfParticipants()"
                                          ng-disabled="headerModel.readOnly.is"
                                          ng-class="headerModel.order.view.errors.noOfParticipants?'bg-danger':null">
    </td>
    <td style="width: 12%" ng-hide="headerModel.order.properties.isWholesaleEvent">
      <label>ילדים:</label>&nbsp;<input type="number" min="-999" max="9999"
                                          placeholder="מתוכם"
                                          ng-model="headerModel.order.properties.children"
                                          ng-change="headerModel.setChildren()"
                                          ng-disabled="headerModel.readOnly.is"
                                          ng-class="headerModel.order.view.errors.children?'bg-danger':null">
    </td>
    <td style="width: 26%; font-size: x-large" ng-show="headerModel.order.properties.isWholesaleEvent">
      <label>אירוע סיטונאי</label>
    </td>
    <td  ng-show="!orderModel.order.properties.template"
         style="width: 15%">
      <label>סטטוס:</label>&nbsp;
      <select ng-model="headerModel.order.view.orderStatus"
              ng-change="headerModel.statusChanged()"
              ng-options="orderStatus.name for orderStatus in headerModel.orderStatuses">
      </select>
    </td>
    <td  ng-show="orderModel.order.properties.template"></td>
  </tr>
    <tr ng-show="headerModel.order.properties.quotes.length">
      <td>
        <label>
        {{(headerModel.order.view.quote?headerModel.order.view.quote.title:
        headerModel.order.properties.quotes[headerModel.order.properties.activeQuote].title)+':'}}
        </label>
      </td>
    <td>
      <label>סכום: </label>&nbsp;<span>
      {{headerModel.order.view.quote?headerModel.order.view.quote.total:
            headerModel.order.properties.quotes[headerModel.order.properties.activeQuote].total | currency}}
    </span>
    </td>
    <td>
      <label>קופסאות: </label>&nbsp;<span>
      {{headerModel.order.view.quote?headerModel.order.view.quote.boxEstimate:
            headerModel.order.properties.quotes[headerModel.order.properties.activeQuote].boxEstimate | number:2}}
    </span>
    </td>
    <td>
      <label>שובע: </label>&nbsp;<span>
      {{headerModel.order.view.quote?
          headerModel.order.view.quote.satietyIndex / headerModel.order.properties.noOfParticipants:
          headerModel.order.properties.quotes[headerModel.order.properties.activeQuote].satietyIndex /
              headerModel.order.properties.noOfParticipants | number:2}}
      </span>
    </td>
      <td></td>
      <td>
        <button class="btn btn-default"
                ng-click="headerModel.showDetails(headerModel.showSummary.is)">
          <span ng-hide="headerModel.showSummary.is">הסתר פרטים</span>
          <span ng-show="headerModel.showSummary.is">הצג פרטים</span>
        </button>
      </td>
  </tr>
  <tr ng-hide="headerModel.order.properties.quotes.length"
      ng-class="(headerModel.order.view.orderStatus.id > 0 &&
                headerModel.order.view.orderStatus.id < 6) ||
                headerModel.order.properties.template ? 'bg-danger' : null">
    <td colspan="5">אין תפריטים</td>
    <td>
      <button class="btn btn-default"
              ng-click="headerModel.showDetails(headerModel.showSummary.is)">
        <span ng-hide="headerModel.showSummary.is">הסתר פרטים</span>
        <span ng-show="headerModel.showSummary.is">הצג פרטים</span>
      </button>
    </td>
  </tr>
</table>
</div>
