<div ng-controller="ItemsCtrl as itemsModel">
<button ng-click="itemsModel.addItem(true)"
        ng-show="!itemsModel.isAddTemplate && !itemsModel.isAddItem"
        ng-disabled="itemsModel.isReadOnly"
        class="btn btn-default"
        >הוסף פריט</button>
<button ng-click="itemsModel.addItem(false)"
        ng-show="itemsModel.isAddItem"
        ng-disabled="itemsModel.isReadOnly"
        class="btn btn-warning">
    בטל
</button>
<span ng-show="itemsModel.isAddItem">
    <select ng-model="itemsModel.currentCategory" ng-change="itemsModel.setCategory()"
            ng-options="category.label for category in itemsModel.categories"></select>
    <label>סינון:</label><input type="text" ng-model="itemsModel.filterText"
                                ng-change="itemsModel.filterProducts()">
    <table border="1">
      <thead>
      <th>שם מנה</th>
      <th>כבר מופיע?</th>
      </thead>
      <tbody>
      <tr ng-repeat="product in itemsModel.filteredCatalog">
        <td ng-click="itemsModel.setProduct(product)">{{product.productDescription}}</td>
        <td>{{product.isInOrder | checkMark}}</td>
      </tr>
      </tbody>
    </table>
</span>
<button ng-click="itemsModel.addTemplate(true)"
        ng-show="!itemsModel.isAddTemplate && !itemsModel.isAddItem"
        ng-disabled="itemsModel.isReadOnly"
        class="btn btn-default">
    הוסף תבנית
</button>
<span ng-show="itemsModel.isAddTemplate">
  <button ng-click="itemsModel.addTemplate(false)"
          ng-disabled="itemsModel.isReadOnly"
          class="btn btn-warning">
      בטל
  </button>
  &nbsp;
  <span>
    התאמת כמויות
  </span>
  <input type="checkbox" ng-model="itemsModel.isAdjustQuantity">
  <table border="1">
    <thead>
    <th>שם תבנית</th>
    <th>משתתפים</th>
    </thead>
      <tbody>
      <tr ng-repeat="template in itemsModel.templates">
        <td ng-click="itemsModel.setTemplate(template)">
          {{template.attributes.template}}
        </td>
        <td ng-click="itemsModel.setTemplate(template)">
          {{template.attributes.noOfParticipants}}
        </td>
      </tr>
      </tbody>
  </table>
</span>
<table style="width: 80%">
  <thead>
  <th style="width: 9%">קטגוריה</th>
  <th style="width: 73%">מוצר</th>
  <th style="width: 6%">יח'</th>
  <th style="width: 2%">כמות</th>
  <th style="width: 5%">מחיר</th>
  <th style="width: 5%">בונוס</th>
  </thead>
  <tbody>
  <tr ng-repeat="item in itemsModel.order.view.quote.items track by item.index"
      ng-class="item.isChanged?'myChanged':null">
    <td>{{item.category.label}}</td>
    <td>
      <input type="text" size="100" ng-model="item.productDescription"
             ng-change="itemsModel.setProductDescription($index)"
             ng-disabled="itemsModel.isReadOnly"
             ng-class="item.errors.productDescription?'myError':null">
    </td>
    <td>{{item.measurementUnit.label}}</td>
    <td>
      <input type="number" size="1" min=0 max="10000"
             ng-model="item.quantity"
             ng-change="itemsModel.setQuantity($index)"
             ng-disabled="itemsModel.isReadOnly"
             ng-class="item.errors.quantity?'myError':null">
    </td>
    <td>
      <input type="text" size="7" money min=0 ng-model="item.price"
             ng-change="itemsModel.setPrice($index)"
             ng-disabled="itemsModel.isReadOnly"
             ng-class="item.errors.price?'myError':null">
    </td>
    <td>
      <input type="checkbox"
             ng-model="item.isFreeItem"
             ng-change="itemsModel.setFreeItem($index)"
             ng-disabled="itemsModel.isReadOnly"
          >
    </td>
    <td>
      <button ng-click="itemsModel.deleteItem($index)"
              ng-disabled="itemsModel.isReadOnly"
              class="btn btn-warning btn-sm"
          >מחק</button>
    </td>
  </tr>
  </tbody>
</table>
</div>
